<!doctype html>
<html lang="en" class="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Grocery Ledger</title>
  <link rel="stylesheet" href="style.css" />
  
  <!-- SheetJS library for XLSX export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
  <!-- WhatsApp integration removed -->
  
  <script type="module">
    // Import Firebase SDKs
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, doc, getDoc, setDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    
    // Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBrUpBBaUUCMJHAn4PrLvqca6Y9irf9sVc",
      authDomain: "canteen-expense-tracker.firebaseapp.com",
      projectId: "canteen-expense-tracker",
      storageBucket: "canteen-expense-tracker.firebasestorage.app",
      messagingSenderId: "645678385425",
      appId: "1:645678385425:web:491764cd5d7da37b0b24b0",
      measurementId: "G-MC3CLPQG6V"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    window.db = getFirestore(app);
    window.firestoreDoc = doc;
    window.firestoreGetDoc = getDoc;
    window.firestoreSetDoc = setDoc;
  </script>
</head>
<body>
  <header class="topbar">
    <div class="brand">ðŸ›’ Grocery Ledger</div>
    <div class="actions">
      <button id="startMonth" class="btn btn-outline">Start New Month</button>
      <button id="exportBtn" class="btn btn-primary">Export JSON</button>
      <button id="exportXlsxBtn" class="btn btn-primary">ðŸ“Š Export Excel</button>
      <button id="themeToggle" class="btn btn-ghost" title="Toggle dark mode" aria-pressed="false">ðŸŒ™</button>
      <label class="btn btn-ghost" for="importFile">Import JSON</label>
      <input id="importFile" type="file" accept="application/json" style="display:none" />
    </div>
  </header>

  <main class="container">
    <section class="summary card">
      <div class="stat-cards">
        <div class="stat-card">
          <div class="stat-icon">ðŸ’°</div>
          <div class="stat-body">
            <div class="stat-label">Total Fund</div>
            <div id="totalFund" class="stat-value">â‚¹5000</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">ðŸ§¾</div>
          <div class="stat-body">
            <div class="stat-label">Total Spent</div>
            <div id="totalSpent" class="stat-value">â‚¹0.00</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">ðŸ’³</div>
          <div class="stat-body">
            <div class="stat-label">Remaining</div>
            <div id="remaining" class="stat-value">â‚¹5000</div>
          </div>
        </div>

        <div class="stat-card small">
          <div class="stat-icon">ðŸ“…</div>
          <div class="stat-body">
            <div class="stat-label">Month</div>
            <div id="month" class="stat-value">â€”</div>
            <div class="stat-extra" id="expenseCount">0 expenses</div>
          </div>
        </div>
      
        <!-- Compact Add Funds card moved into stat area -->
        <div class="stat-card add-fund-card">
          <div class="stat-icon">âž•</div>
          <div class="stat-body">
            <div class="stat-label">Add Funds</div>
            <div style="display:flex;align-items:center;gap:8px;margin-top:6px">
              <input id="addFundAmount" type="number" min="0.01" step="0.01" placeholder="â‚¹ amount" />
              <button id="addFundBtn" class="btn btn-primary">Add</button>
            </div>
            <div class="stat-extra small-muted">Quick top-up</div>
          </div>
        </div>
      </div>

        <div class="friends-list" id="friendsList">
          <!-- friend spent cards -->
        </div>
    </section>

    <section class="card form-card">
      <h3>Add Expense</h3>
      <form id="expenseForm">
        <div class="form-row">
          <label for="spender">Spender</label>
          <select id="spender" required></select>
        </div>
        <div class="items-section">
          <div class="items-inputs">
            <input id="itemName" type="text" placeholder="Item name (eg. Milk)" />
            <input id="itemQty" type="number" min="1" value="1" />
            <input id="itemPrice" type="number" min="0.01" step="0.01" placeholder="Price" />
            <button id="addItemBtn" class="btn btn-outline">Add Item</button>
          </div>
          <div id="itemsList" class="items-list"><!-- added items appear here --></div>
          <div class="items-subtotal">Subtotal: <span id="subtotal">â‚¹0.00</span></div>
        </div>
        <div class="form-row">
          <label for="amount">Amount (â‚¹)</label>
          <input id="amount" type="number" min="0" step="0.01" required />
        </div>
        <div class="form-row">
          <label for="description">Description</label>
          <input id="description" type="text" placeholder="eg. Milk & Bread" />
        </div>
        <div class="form-row">
          <label for="date">Date</label>
          <input id="date" type="date" required />
        </div>
        <div class="form-row form-actions">
          <button type="submit" class="btn btn-primary">Add Expense</button>
          <button type="reset" class="btn btn-outline">Reset</button>
        </div>
      </form>
    </section>

    <!-- WhatsApp Integration removed -->

    <!-- Reports Section -->
    <section class="card reports-card">
      <h3>Reports & Insights</h3>
      <div class="reports-controls">
  <button id="report7" type="button" class="btn btn-outline">Last 7 days</button>
  <button id="report30" type="button" class="btn btn-outline">Last 30 days</button>
        <label class="small-muted">From <input id="reportFrom" type="date" /></label>
        <label class="small-muted">To <input id="reportTo" type="date" /></label>
  <button id="reportCustom" type="button" class="btn btn-primary">Generate</button>
      </div>
      <div id="reportResults" class="report-results"></div>
    </section>

    <section class="card ledger-card">
      <h3>Expense Ledger</h3>
      <div class="ledger-filters">
        <input id="ledgerSearch" type="search" placeholder="Search ledger (spender, desc, items, amount)" />
        <select id="filterSpender"><option value="all">All spenders</option></select>
        <select id="filterType"><option value="all">All types</option><option value="expense">Expense</option><option value="fund">Top-up</option></select>
        <label class="small-muted">From <input id="filterFrom" type="date" /></label>
        <label class="small-muted">To <input id="filterTo" type="date" /></label>
        <button id="clearFilters" class="btn btn-outline">Clear</button>
      </div>
      <div class="table-wrap">
        <table id="ledgerTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>Spender</th>
              <th>Amount (â‚¹)</th>
              <th>Description</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- expenses -->
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <footer class="footer">Built for 5 friends â€¢ Hosted on GitHub Pages</footer>

  <!-- Confirmation modal (used for delete/critical confirmations) -->
  <div id="confirmModal" class="modal" aria-hidden="true">
    <div class="modal-backdrop"></div>
    <div class="modal-panel" role="dialog" aria-modal="true">
      <div class="modal-body">
        <div id="confirmMessage">Are you sure?</div>
        <div class="modal-actions">
          <button id="confirmCancel" class="btn btn-outline">Cancel</button>
          <button id="confirmOk" class="btn btn-danger">Confirm</button>
        </div>
      </div>
    </div>
  </div>

  <script src="analytics.js" defer></script>
  <script src="app.js" defer></script>
</body>
</html>
